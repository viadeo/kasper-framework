machine:
  environment:
    TERM: dumb
  timezone:
    Europe/Paris
  hosts:
    ## CircleCI AWS SecurityGroup Access
    nexus.viadeobackoffice.com: 10.69.181.179
  java:
    version: oraclejdk8

dependencies:
  cache_directories:
    - "~/.gradle"

  override:
    - ./gradlew --no-daemon compileJava compileTestJava findbugsMain assemble --parallel --max-workers=2:
        timeout: 300

test:
  override:
    - ./gradlew --no-daemon -a circleCheck --parallel --max-workers=2:
        parallel: true
  post:
      # Delete useless report files that would slow the Collect phase of CircleCi
      - echo "Delete success report"
      - grep -lRL "failure message" $CIRCLE_TEST_REPORTS | xargs rm -f


deployment:
  nexus:
    branch: [develop, prepare_1.0.0]
    owner: viadeo
    commands:
      - ./gradlew --no-daemon -a circleUploadArchives --parallel-threads=2
