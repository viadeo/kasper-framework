
Exploiting metrics
========================


..  _Using_metrics:

Using metrics
------------------------

Kasper framework uses `Yammer's Metrics library <http://metrics.codahale.com/>`_ to manage its provided
metrics and encourages you to use it in your platform developments.

Get the global `MetricRegistry` using `KasperMetrics.getMetricRegistry()` and simply use it as explained in
the `Metrics documentation <http://metrics.codahale.com/>`_.


..  _Default_metrics:

Default metrics
------------------------

**Exposition**

Warning: Available only if http eposition plugins are registered

+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                                                                           | Description                                                 |
+===========+================================================================================================================================+=============================================================+
| Meter     | com.viadeo.kasper.cqrs.exposition.http.<'httpcommandexposer' or 'httpqueryexposer' or 'httpeventexposer'>.errors               | Rate of failed http request                                 |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.cqrs.exposition.http.<'httpcommandexposer' or 'httpqueryexposer' or 'httpeventexposer'>.requests             | Rate of http request                                        |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.cqrs.exposition.http.<'httpcommandexposer' or 'httpqueryexposer' or 'httpeventexposer'>.requests-handle-time | Time to handle http request                                 |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.cqrs.exposition.http.<'httpcommandexposer' or 'httpqueryexposer' or 'httpeventexposer'>.requests-time        | Time to handle request itself without exposition layer      |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.<query>.requests.requests-handle-time                                                                                 | Time to handle http request related to a specific query     |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.<command>.requests.requests-handle-time                                                                               | Time to handle http request related to a specific command   |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.<event>.requests.requests-handle-time                                                                                 | Time to handle http request related to a specific event     |
+-----------+--------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------+


**Unit of work**

+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                 | Description                                                 |
+===========+======================================================================+=============================================================+
| Meter     | com.viadeo.kasper.cqrs.command.kasperunitofwork.committed            |                                                             |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+


**Command**

+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                 | Description                                                 |
+===========+======================================================================+=============================================================+
| Meter     | com.viadeo.kasper.cqrs.command.commandgateway.requests               | Rate of request for all commands                            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.cqrs.command.commandgateway.requests-time          | Time to handle the command (all)                            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.cqrs.command.commandgateway.errors                 | Rate of failed request for all commands                     |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.command.<command>.requests                                  | Rate of requests for a specific command                     |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.command.<command>.requests-time                             | Time to handle the specific command                         |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.command.<command>.errors                                    | Rate of failed requests for a specific command              |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | client.<client>.command.<command>.requests                           | Rate of request for all commands per client type            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | client.<client>.command.<command>.errors                             | Rate of failed request for all commands per client type     |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+


**Query**

+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                                       | Description                                                 |
+===========+============================================================================================+=============================================================+
| Meter     | com.viadeo.kasper.cqrs.query.querygateway.requests                                         | Rate of request for all queries                             |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.cqrs.query.querygateway.requests-time                                    | Time to handle the query (all)                              |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.cqrs.query.querygateway.errors                                           | Rate of failed request for all queries                      |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.query.<query>.requests                                                            | Rate of requests for a specific query                       |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.query.<query>.requests-time                                                       | Time to handle the specific query                           |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.query.<query>.errors                                                              | Rate of failed requests for a specific query                |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | client.<client>.query.<query>.requests                                                     | Rate of request for all queries per client type             |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | client.<client>.query.<query>.errors                                                       | Rate of failed request for all queries per client type      |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.cqrs.query.interceptor.queryhandlerinterceptor.interceptor-requests-time | Time to handle interceptor of the specific query (all)      |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.<query>.requests-interceptor-requests-time                                        | Time to handle interceptor of the specific query            |
+-----------+--------------------------------------------------------------------------------------------+-------------------------------------------------------------+


**Event**

+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                 | Description                                                 |
+===========+======================================================================+=============================================================+
| Meter     | com.viadeo.kasper.event.eventlistener.handles                        | Rate of handling events (all)                               |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | com.viadeo.kasper.event.eventlistener.handle-time                    | Time to handle an listened event (all)                      |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.event.eventlistener.errors                         | Rate of errors handling events (all)                        |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.eventlistener.handles                                       | Rate of handling all listened events per domain             |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.eventlistener.handle-time                                   | Time to handle all listened event per domain                |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.eventlistener.errors                                        | Rate of errors handling all listened events per domain      |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.eventlistener.<eventlistener>.requests                      | Rate of handling events for this listener                   |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.eventlistener.<eventlistener>.requests-time                 | Time to handle this listened event                          |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.eventlistener.<eventlistener>.errors                        | Rate of failed handling events for this listener            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+

**Repository**

+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Type      | Name                                                                 | Description                                                 |
+===========+======================================================================+=============================================================+
| Meter     | com.viadeo.kasper.ddd.irepository.deletes                            | Rate of delete operations for all repository                |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | com.viadeo.kasper.ddd.irepository.delete-times                       | Distribution of time to delete for all repositories         |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.ddd.irepository.delete-errors                      | Rate of errors during delete operations for all repositories|
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.ddd.irepository.loads                              | Rate of load operations for all repository                  |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | com.viadeo.kasper.ddd.irepository.load-times                         | Distribution of time to load for all repositories           |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.ddd.irepository.load-errors                        | Rate of errors during load operations for all repositories  |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.ddd.irepository.saves                              | Rate of save operations for all repository                  |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | com.viadeo.kasper.ddd.irepository.save-times                         | Distribution of time to save for all repositories           |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | com.viadeo.kasper.ddd.irepository.save-errors                        | Rate of errors during save operations for all repositories  |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.deletes                             | Rate of delete operations for this repository               |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | <domain>.repository.<repository>.delete-times                        | Distribution of time to delete for this repository          |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.repository.<repository>.delete-time                         | Time to delete for this repository                          |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.delete-errors                       | Rate of errors during delete operations for this repository |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.loads                               | Rate of load operations for this repository                 |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | <domain>.repository.<repository>.load-times                          | Distribution of time to load for this repository            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.repository.<repository>.load-time                           | Time to load for this repository                            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.load-errors                         | Rate of errors during load operations for this repository   |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.saves                               | Rate of save operations for this repository                 |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Histogram | <domain>.repository.<repository>.save-times                          | Distribution of time to save for this repository            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Timer     | <domain>.repository.<repository>.save-time                           | Time to save for this repository                            |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+
| Meter     | <domain>.repository.<repository>.save-errors                         | Rate of errors during save operations for this repository   |
+-----------+----------------------------------------------------------------------+-------------------------------------------------------------+


..  _Defining_reporter:

Defining reporter
------------------------

You can implement your own reporter easily in adding a reporter initializer to the plugin : MetricsPlugin

.. code-block:: java
    :linenos:

    public interface MyReporterInitializer implements ReporterInitializer {

        @Override
        public void initialize(MetricRegistry metricRegistry) {
            // Here your implementation
        }
    }

.. code-block:: java
    :linenos:

    Platform platform = new Platform.Builder(new KasperPlatformConfiguration.class)
        .addPlugin(
            new MetricsPlugin(
                  new Slf4ReporterInitializer()
                , new MyReporterInitializer()
            )
        )
        .build();


..  _List_of_available_reporter:

List of available reporter
------------------------

List of default reporter initializer provided by the framework :

+-----------------------------+---------------------------------------------------------------------------------------------------------------------------------------+
| Name                        | Description                                                                                                                           |
+=============================+=======================================================================================================================================+
| Slf4jReporterInitializer    | Initialize a SLF4J reporter with log level set to TRACE, through the **Platform** class logger, publishing metrics every 20 seconds.  |
+-----------------------------+---------------------------------------------------------------------------------------------------------------------------------------+

